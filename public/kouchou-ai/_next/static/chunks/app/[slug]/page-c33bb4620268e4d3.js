(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[182],{18133:(e,t,l)=>{"use strict";l.d(t,{J:()=>o});var r=l(95155),n=l(77342),i=l(12115),a=l(14549);let o=i.forwardRef(function(e,t){var l;return(0,r.jsx)(n.K,{variant:"ghost","aria-label":"Close",ref:t,...e,children:null!==(l=e.children)&&void 0!==l?l:(0,r.jsx)(a.SXS,{})})})},30934:(e,t,l)=>{"use strict";l.d(t,{ClientContainer:()=>U});var r=l(95155),n=l(59002),i=l(12115);let a=i.forwardRef(function(e,t){let{icon:l,children:i,inputProps:a,rootRef:o,...s}=e;return(0,r.jsxs)(n.y8,{ref:o,...s,children:[(0,r.jsx)(n.Ks,{ref:t,...a}),(0,r.jsx)(n.v7,{children:l||(0,r.jsx)(n.P7,{})}),null!=i&&(0,r.jsx)(n.Sb,{children:i})]})});var o=l(99840),s=l(81068),c=l(90310),u=l(17921),d=l(65506),m=l(25588),h=l(77042),f=l(38567),x=l(77204);let g=i.memo(function(e){let{attrName:t,value:l,checked:n,count:i,onChange:o}=e;return(0,r.jsxs)(s.Box,{p:1,px:2,borderWidth:1,borderRadius:"md",bg:n?"blue.50":"transparent",_hover:{bg:"gray.50"},cursor:"pointer",onClick:()=>o(t,l),children:[(0,r.jsx)(a,{checked:n,onChange:()=>o(t,l),children:l||"(空)"}),(0,r.jsx)(c.Text,{as:"span",fontSize:"xs",ml:1,color:"gray.500",children:i})]})});function b(e){let{attributes:t=[],onClose:l,onApplyFilters:n,initialFilters:b={},initialNumericRanges:p={},initialEnabledRanges:v={},initialIncludeEmptyValues:j={},initialTextSearch:y=""}=e;(0,i.useMemo)(()=>t.map(e=>e.name),[t]);let[C,S]=(0,i.useState)(b),[w,k]=(0,i.useState)(Object.keys(p).length>0?p:Object.fromEntries(t.filter(e=>"numeric"===e.type&&e.numericRange).map(e=>[e.name,e.numericRange]))),[z,N]=(0,i.useState)(v),[_,B]=(0,i.useState)(j),[R,A]=(0,i.useState)(y),L=(0,i.useCallback)((e,t)=>{S(l=>{var r;let n=null!==(r=l[e])&&void 0!==r?r:[],i=n.includes(t)?n.filter(e=>e!==t):[...n,t],a={...l};return 0===i.length?delete a[e]:a[e]=i,a})},[]),M=(0,i.useCallback)((e,l,r)=>{k(n=>{var i,a,o;let[s,c]=null!==(o=null!==(a=n[e])&&void 0!==a?a:null===(i=t.find(t=>t.name===e))||void 0===i?void 0:i.numericRange)&&void 0!==o?o:[0,0],u=0===l?[Math.min(r,c),c]:[s,Math.max(r,s)];return{...n,[e]:u}})},[t]),D=(0,i.useCallback)(e=>{N(t=>({...t,[e]:!t[e]}))},[]),O=(0,i.useCallback)(e=>{B(t=>({...t,[e]:!t[e]}))},[]),T=(0,i.useCallback)(()=>{S({}),k(Object.fromEntries(t.filter(e=>"numeric"===e.type&&e.numericRange).map(e=>[e.name,e.numericRange]))),N({}),B({}),A("")},[t]),E=(0,i.useCallback)(()=>{n(C,w,_,z,R),l()},[C,w,_,z,R,n,l]);return(0,r.jsx)(o.Dz,{lazyMount:!0,open:!0,onOpenChange:l,children:(0,r.jsxs)(o.Cf,{width:"80vw",maxWidth:"1200px",children:[(0,r.jsx)(o.R4,{children:(0,r.jsxs)(s.Box,{mb:6,mt:4,children:[(0,r.jsx)(u.Heading,{as:"h3",size:"md",mb:2,children:"フィルタ"}),(0,r.jsx)(c.Text,{fontSize:"sm",mb:5,color:"gray.600",children:"表示する意見グループを絞り込みます。フィルタ間はAND結合され、フィルタ内の条件はOR結合されます。"}),(0,r.jsxs)(s.Box,{mb:6,borderWidth:1,borderRadius:"md",p:3,children:[(0,r.jsx)(u.Heading,{as:"h4",size:"sm",mb:2,children:"テキスト検索"}),(0,r.jsx)(d.p,{placeholder:"検索したいテキストを入力してください。入力されたテキストが含まれる意見のみ表示されます。",value:R,onChange:e=>A(e.target.value),mb:2})]}),0===t.length?(0,r.jsx)(c.Text,{fontSize:"sm",color:"gray.500",children:"利用できる属性情報がありません。CSVファイルをアップロードする際に、属性列を選択してください。"}):t.map(e=>{var t,l,n,i,o,f,b,p,v;let j="numeric"===e.type;return(0,r.jsxs)(s.Box,{mb:4,children:[(0,r.jsxs)(m.Flex,{align:"center",mb:2,children:[(0,r.jsx)(u.Heading,{size:"sm",mb:0,mr:3,children:e.name}),j&&e.values.length>0&&(0,r.jsx)(a,{checked:!!z[e.name],onChange:()=>D(e.name),children:"フィルター有効化"})]}),j&&e.values.length>0?(0,r.jsx)(s.Box,{pl:2,pr:4,borderWidth:1,borderRadius:"md",p:2,children:(0,r.jsxs)(m.Flex,{align:"center",children:[(0,r.jsx)(a,{checked:!!_[e.name],onChange:()=>O(e.name),disabled:!z[e.name],mr:4,children:"空の値を含める"}),(0,r.jsxs)(c.Text,{fontSize:"xs",width:"60px",textAlign:"right",mr:2,children:["最小: ",null!==(o=null===(t=e.numericRange)||void 0===t?void 0:t[0])&&void 0!==o?o:"-"]}),(0,r.jsx)(d.p,{type:"number",value:null!==(f=null===(l=w[e.name])||void 0===l?void 0:l[0])&&void 0!==f?f:"",onChange:t=>M(e.name,0,Number(t.target.value)),size:"sm",width:"100px",disabled:!z[e.name]}),(0,r.jsx)(c.Text,{mx:2,children:"～"}),(0,r.jsx)(d.p,{type:"number",value:null!==(b=null===(n=w[e.name])||void 0===n?void 0:n[1])&&void 0!==b?b:"",onChange:t=>M(e.name,1,Number(t.target.value)),size:"sm",width:"100px",disabled:!z[e.name]}),(0,r.jsxs)(c.Text,{fontSize:"xs",width:"60px",textAlign:"left",ml:2,children:["最大: ",null!==(p=null===(i=e.numericRange)||void 0===i?void 0:i[1])&&void 0!==p?p:"-"]})]})}):(0,r.jsx)(s.Box,{pl:2,children:e.values.length>100?(0,r.jsx)(x.Y1,{height:300,itemCount:e.values.length,itemSize:40,width:"100%",itemData:{attrName:e.name,values:e.values,checkedList:null!==(v=C[e.name])&&void 0!==v?v:[],valueCounts:e.valueCounts,onChange:L},children:e=>{var t;let{index:l,style:n,data:i}=e,a=i.values[l];return(0,r.jsx)("div",{style:n,children:(0,r.jsx)(g,{attrName:i.attrName,value:a,checked:i.checkedList.includes(a),count:null!==(t=i.valueCounts[a])&&void 0!==t?t:0,onChange:i.onChange})},"".concat(i.attrName,"-").concat(a))}}):(0,r.jsx)(h.B,{style:{gap:"8px"},children:e.values.map(t=>{var l,n;return(0,r.jsx)(h.Q,{mb:2,mr:3,children:(0,r.jsx)(g,{attrName:e.name,value:t,checked:(null===(l=C[e.name])||void 0===l?void 0:l.includes(t))||!1,count:null!==(n=e.valueCounts[t])&&void 0!==n?n:0,onChange:L})},"".concat(e.name,"-").concat(t))})})})]},e.name)})]})}),(0,r.jsxs)(o.Es,{justifyContent:"space-between",children:[(0,r.jsx)(f.Button,{onClick:T,variant:"outline",size:"sm",children:"すべてクリア"}),(0,r.jsx)(f.Button,{onClick:E,colorScheme:"blue",children:"設定を適用"})]})]})})}var p=l(58923),v=l(97377);function j(e){let{loaded:t,max:l,isVisualizing:n}=e;return n?(0,r.jsx)(p.wi,{value:null,size:"xl",mx:"auto",p:5,maxW:"800px",colorPalette:"cyan",children:(0,r.jsxs)(v.HStack,{gap:"5",children:[(0,r.jsx)(p.XL,{flex:"1",children:(0,r.jsx)(p.Fx,{})}),(0,r.jsx)(p.uW,{children:"Visualizing..."})]})}):(0,r.jsx)(p.wi,{value:t,max:l,size:"xl",mx:"auto",p:5,maxW:"800px",colorPalette:"cyan",children:(0,r.jsxs)(v.HStack,{gap:"5",children:[(0,r.jsx)(p.XL,{flex:"1",children:(0,r.jsx)(p.Fx,{})}),(0,r.jsxs)(p.eY,{children:[Math.floor(t/1024).toLocaleString()," KB / ",Math.floor(l/1024).toLocaleString()," KB"]})]})})}let y={moduleType:"locale",name:"ja",dictionary:{Autoscale:"自動スケーリング","Box Select":"ボックス選択","Click to enter Colorscale title":"クリックしてカラースケールのタイトルを入力","Click to enter Component A title":"クリックしてコンポーネントAのタイトルを入力","Click to enter Component B title":"クリックしてコンポーネントBのタイトルを入力","Click to enter Component C title":"クリックしてコンポーネントCのタイトルを入力","Click to enter Plot title":"クリックしてプロットのタイトルを入力","Click to enter X axis title":"クリックしてX軸のタイトルを入力","Click to enter Y axis title":"クリックしてY軸のタイトルを入力","Compare data on hover":"ホバーでデータを比較","Double-click on legend to isolate one trace":"凡例をダブルクリックすると1つのトレースだけを表示","Double-click to zoom back out":"ダブルクリックでズームアウト","Download plot as a png":"PNGとしてプロットをダウンロード","Download plot":"プロットをダウンロード","Edit in Chart Studio":"Chart Studioで編集","IE only supports svg.  Changing format to svg.":"IEはSVG形式のみ対応。SVGに変換します。","Lasso Select":"なげなわ選択","Orbital rotation":"軌道回転",Pan:"パン操作","Produced with Plotly.js":"Plotly.js により作成",Reset:"リセット","Reset axes":"軸をリセット","Reset camera to default":"カメラをデフォルト位置にリセット","Reset camera to last save":"カメラを最後の保存状態に戻す","Reset view":"ビューをリセット","Reset views":"ビューをリセット","Show closest data on hover":"ホバー時に最も近いデータを表示","Snapshot succeeded":"スナップショットに成功しました","Sorry, there was a problem downloading your snapshot!":"スナップショットのダウンロード中に問題が発生しました","Taking snapshot - this may take a few seconds":"スナップショットを作成中（数秒かかる場合があります）",Zoom:"ズーム","Zoom in":"拡大","Zoom out":"縮小","close:":"終値:",trace:"トレース:","lat:":"緯度:","lon:":"経度:","q1:":"第1四分位数:","q3:":"第3四分位数:","source:":"ソース:","target:":"ターゲット:","lower fence:":"下限フェンス:","upper fence:":"上限フェンス:","max:":"最大:","mean \xb1 σ:":"平均 \xb1 σ:","mean:":"平均:","median:":"中央値:","min:":"最小:","Turntable rotation":"ターンテーブル回転","Toggle Spike Lines":"スパイクラインの切り替え","open:":"始値:","high:":"高値:","low:":"安値:","Toggle show closest data on hover":"ホバー時の最も近いデータ表示を切り替え","incoming flow count:":"流入フロー数:","outgoing flow count:":"流出フロー数:","kde:":"カーネル密度推定:","Click to enter radial axis title":"クリックして放射軸のタイトルを入力","new text":"新しいテキスト"},format:{days:["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"],shortDays:["日","月","火","水","木","金","土"],months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],shortMonths:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],date:"%Y/%m/%d"}},C=(0,l(55028).default)(async()=>{let e=await Promise.all([l.e(466),l.e(709),l.e(478),l.e(809),l.e(722),l.e(638),l.e(502)]).then(l.t.bind(l,47502,23)),t=await Promise.all([l.e(466),l.e(709),l.e(478),l.e(809),l.e(722),l.e(638),l.e(909)]).then(l.t.bind(l,50909,23)),r=await Promise.all([l.e(466),l.e(709),l.e(478),l.e(809),l.e(224),l.e(397)]).then(l.t.bind(l,18397,23)),n=await Promise.all([l.e(466),l.e(709),l.e(478),l.e(809),l.e(224),l.e(549)]).then(l.t.bind(l,12549,23)),i=await Promise.all([l.e(466),l.e(709),l.e(478),l.e(608),l.e(809),l.e(722),l.e(778)]).then(l.t.bind(l,15778,23)),a=(await l.e(291).then(l.bind(l,72291))).default;return e.register([t,r,n,i]),e.register(y),a(e)},{loadableGenerated:{webpack:()=>[72291]},ssr:!1,loading:()=>(0,r.jsx)(j,{loaded:100,max:100,isVisualizing:!0})});function S(e){let{clusterList:t,argumentList:l,targetLevel:n,onHover:i,showClusterLabels:a,filteredArgumentIds:o,config:c,labelFontSize:u=14,labelMaxWidth:d=228}=e,m=t.filter(e=>e.level===n),h=["#7ac943","#3fa9f5","#ff7997","#e0dd02","#d6410f","#b39647","#7cccc3","#a147e6","#ff6b6b","#4ecdc4","#ffbe0b","#fb5607","#8338ec","#3a86ff","#ff006e","#8ac926","#1982c4","#6a4c93","#f72585","#7209b7","#00b4d8","#e76f51","#606c38","#9d4edd","#457b9d","#bc6c25","#2a9d8f","#e07a5f","#5e548e","#81b29a","#f4a261","#9b5de5","#f15bb5","#00bbf9","#98c1d9","#84a59d","#f28482","#00afb9","#cdb4db","#fcbf49"],f=m.reduce((e,t,l)=>(e[t.id]=h[l%h.length],e),{}),x=m.reduce((e,t,l)=>(e[t.id]=h[l%h.length]+Math.floor(204).toString(16).padStart(2,"0"),e),{}),g=e=>{let t="",l="",r=0;for(let n=0;n<e.length;n++){let i=e[n],a=(/[!-~]/.test(i)?.6:1)*u;(r+=a)>d?(t+="".concat(l,"<br>"),l=i,r=a):l+=i}return l&&(t+="".concat(l)),t},b=e=>o?{matching:l.filter(t=>t.cluster_ids.includes(e.id)&&o.includes(t.arg_id)),notMatching:l.filter(t=>t.cluster_ids.includes(e.id)&&!o.includes(t.arg_id))}:{matching:l.filter(t=>t.cluster_ids.includes(e.id)),notMatching:[]},p=m.map(e=>{let t=l.filter(t=>t.cluster_ids.includes(e.id)),r=t.map(e=>e.x),n=t.map(e=>e.y),i=r.length>0?r.reduce((e,t)=>e+t,0)/r.length:0,a=n.length>0?n.reduce((e,t)=>e+t,0)/n.length:0,{matching:s,notMatching:u}=b(e),d=o&&(0===s.length||e.allFiltered),m=u.length>0||d?{x:u.length>0?u.map(e=>e.x):t.map(e=>e.x),y:u.length>0?u.map(e=>e.y):t.map(e=>e.y),mode:"markers",marker:{size:7,color:Array(u.length>0?u.length:t.length).fill("#cccccc"),opacity:Array(u.length>0?u.length:t.length).fill(.5)},text:Array(u.length>0?u.length:t.length).fill(""),type:"scattergl",hoverinfo:"skip",showlegend:!1,customdata:u.length>0?u.map(e=>({arg_id:e.arg_id,url:e.url})):t.map(e=>({arg_id:e.arg_id,url:e.url}))}:null,h=s.length>0?{x:s.map(e=>e.x),y:s.map(e=>e.y),mode:"markers",marker:{size:10,color:Array(s.length).fill(f[e.id]),opacity:Array(s.length).fill(1),line:(null==c?void 0:c.enable_source_link)?{width:2,color:"#ffffff"}:void 0},text:s.map(t=>{let l=t.argument.replace(/(.{30})/g,"$1<br />"),r=(null==c?void 0:c.enable_source_link)&&t.url?"<br><b>\uD83D\uDD17 クリックしてソースを見る</b>":"";return"<b>".concat(e.label,"</b><br>").concat(l).concat(r)}),type:"scattergl",hoverinfo:"text",hovertemplate:"%{text}<extra></extra>",hoverlabel:{align:"left",bgcolor:"#555555",bordercolor:f[e.id],font:{size:12,color:"#fff"}},showlegend:!1,customdata:s.map(e=>({arg_id:e.arg_id,url:e.url}))}:null;return{cluster:e,notMatchingData:m,matchingData:h,centerX:i,centerY:a}}),v=p.flatMap(e=>{let t=[];if(e.notMatchingData&&t.push(e.notMatchingData),e.matchingData&&t.push(e.matchingData),!o){let r=l.filter(t=>t.cluster_ids.includes(e.cluster.id));r.length>0&&t.push({x:r.map(e=>e.x),y:r.map(e=>e.y),mode:"markers",marker:{size:7,color:f[e.cluster.id]},text:r.map(t=>"<b>".concat(e.cluster.label,"</b><br>").concat(t.argument.replace(/(.{30})/g,"$1<br />"))),type:"scattergl",hoverinfo:"text",hoverlabel:{align:"left",bgcolor:"#555555",bordercolor:f[e.cluster.id],font:{size:12,color:"#fff"}},showlegend:!1,customdata:r.map(e=>({arg_id:e.arg_id,url:e.url}))})}return t}),j=a?p.map(e=>{let t=o&&(0===b(e.cluster).matching.length||e.cluster.allFiltered)?x[e.cluster.id].replace(/[0-9a-f]{2}$/i,"cc"):x[e.cluster.id];return{x:e.centerX,y:e.centerY,text:g(e.cluster.label),showarrow:!1,font:{color:"white",size:u,weight:700},bgcolor:t,borderpad:10,width:d,align:"left"}}):[];return(0,r.jsx)(s.Box,{width:"100%",height:"100%",display:"flex",flexDirection:"column",children:(0,r.jsx)(s.Box,{position:"relative",flex:"1",children:(0,r.jsx)(C,{data:v,layout:{margin:{l:0,r:0,b:0,t:0},paper_bgcolor:"#171717",plot_bgcolor:"#171717",xaxis:{zeroline:!1,showticklabels:!1,showgrid:!1},yaxis:{zeroline:!1,showticklabels:!1,showgrid:!1},hovermode:"closest",dragmode:"pan",annotations:j,showlegend:!1},useResizeHandler:!0,style:{width:"100%",height:"100%",cursor:(null==c?void 0:c.enable_source_link)?"pointer":"default"},config:{responsive:!0,displayModeBar:"hover",scrollZoom:!0,locale:"ja"},onHover:i,onUpdate:e=>{try{for(let e of document.querySelectorAll("g.annotation")){let t=e.querySelector("rect.bg");t&&(t.setAttribute("rx","".concat(4,"px")),t.setAttribute("ry","".concat(4,"px")))}}catch(e){console.error("アノテーション要素の角丸化に失敗しました:",e)}!function(){let e=document.querySelector(".modebar-container");if(!e)return;let t=e.children[0],l=document.getElementById("fullScreenButtons");if(!t||!l)return;let r=t.getBoundingClientRect(),n=l.getBoundingClientRect();if(n.top>r.bottom||n.bottom<r.top||n.left>r.right||n.right<r.left)return;let i=n.bottom-r.top;e.style.top="".concat(Number.parseInt(e.style.top.slice(0,-2))+i+10,"px")}()},onClick:e=>{if(null==c?void 0:c.enable_source_link)try{var t;let r=null===(t=e.points)||void 0===t?void 0:t[0];if(null==r?void 0:r.customdata){let e=r.customdata;if(e.url)window.open(e.url,"_blank","noopener,noreferrer");else{let t=l.find(t=>t.arg_id===e.arg_id);(null==t?void 0:t.url)?window.open(t.url,"_blank","noopener,noreferrer"):console.log("No URL found for argument:",e.arg_id)}}else console.log("No customdata found in clicked point")}catch(e){console.error("Error in click handler:",e)}}})})})}function w(e){let{clusterList:t,argumentList:l,onHover:n,level:i,onTreeZoom:a,filteredArgumentIds:o}=e,s=!!o,c=l.map(e=>{var t;let l={level:3,id:(t=e).arg_id,label:t.argument,takeaway:"",value:1,parent:t.cluster_ids[2],density_rank_percentile:0};return o&&!o.includes(e.arg_id)?{...l,filtered:!0}:l}),u={};for(let e of t)u[e.id]=0;for(let e of l)if(!s||o.includes(e.arg_id))for(let t of e.cluster_ids)void 0!==u[t]&&u[t]++;let d=[{...t[0],parent:""},...t.slice(1),...c],m=d.map(e=>e.id),h=d.map(e=>e.id===i?e.label.replace(/(.{50})/g,"$1<br />"):e.label.replace(/(.{15})/g,"$1<br />")),f=d.map(e=>e.parent),x=d.map(e=>void 0!==u[e.id]?s?u[e.id]:e.value:+!e.filtered),g={type:"treemap",ids:m,labels:h,parents:f,values:x,customdata:d.map(e=>{let t=e.takeaway.replace(/(.{15})/g,"$1<br />");if(void 0!==u[e.id]&&s){let l=e.value,r=u[e.id];r<l&&(t="".concat(t,"<br><br>元の件数: ").concat(l,"<br>フィルター後: ").concat(r))}return e.filtered?"":t}),level:i,branchvalues:"total",marker:{colors:d.map(e=>e.filtered?"#cccccc":""),line:{width:1,color:"white"},opacity:d.map(e=>e.filtered?.5:1)},hoverinfo:"text",hovertemplate:"%{customdata}<extra></extra>",hoverlabel:{align:"left",bgcolor:"#555555",font:{color:"#fff"}},texttemplate:s?"%{label}<br>%{value:,}件 (フィルター後)<br>%{percentEntry:.2%}":"%{label}<br>%{value:,}件<br>%{percentEntry:.2%}",maxdepth:2,pathbar:{thickness:28}};return(0,r.jsx)(C,{data:[g],layout:{margin:{l:10,r:10,b:10,t:30},paper_bgcolor:"#171717",plot_bgcolor:"#171717",colorway:["#b3daa1","#f5c5d7","#d5e5f0","#fbecc0","#80b8ca","#dabeed","#fad1af","#fbb09d","#a6e3ae","#f1e4d6"]},useResizeHandler:!0,style:{width:"100%",height:"100%"},config:{responsive:!0,displayModeBar:!1,locale:"ja"},onUpdate:k,onUnhover:k,onHover:()=>{n&&n(),k()},onClick:e=>{var t;let l=e.points[0];a((null===(t=l.data.ids[l.pointNumber])||void 0===t?void 0:t.toString())||"0")}})}function k(){let e=document.querySelectorAll(".treemap > .slice > .surface"),t=z(e[e.length-1]);for(let l of(e.length>1&&N(e[0],t),document.querySelectorAll(".treemap > .pathbar > .surface")))N(l,t)}function z(e){var t;return(null===(t=e.computedStyleMap().get("fill"))||void 0===t?void 0:t.toString())||""}function N(e,t){var l;if(z(e)!==t)return;let r=t.replace(/rgb\((\d+), (\d+), (\d+)\)/,(e,t,l,r)=>"rgb(".concat(_(t),", ").concat(_(l),", ").concat(_(r),")")),n=(null===(l=e.attributes.getNamedItem("style"))||void 0===l?void 0:l.value.replace(t,r))||"";e.setAttribute("style",n)}function _(e){return Math.max(0,Number.parseInt(e)-30)}var B=l(35341),R=l(70318);let A=i.forwardRef(function(e,t){let{showArrow:l,children:n,disabled:i,portalled:a=!0,content:o,contentProps:s,portalRef:c,...u}=e;return i?n:(0,r.jsxs)(B.sb,{...u,children:[(0,r.jsx)(B.k$,{asChild:!0,children:n}),(0,r.jsx)(R.Z,{disabled:!a,container:c,children:(0,r.jsx)(B.ol,{children:(0,r.jsxs)(B.ZI,{ref:t,...s,children:[l&&(0,r.jsx)(B.PR,{children:(0,r.jsx)(B.Mo,{})}),o]})})})]})});var L=l(89682),M=l(7684),D=l(63789);function O(e){let{result:t,selectedChart:l,isFullscreen:n,onExitFullscreen:a,showClusterLabels:o,onToggleClusterLabels:c,treemapLevel:u,onTreeZoom:d,filterState:m}=e,h=(0,i.useRef)(null),[x,g]=(0,i.useState)(1e3);(0,i.useEffect)(()=>{let e=h.current;if(!e)return;let t=new ResizeObserver(e=>{for(let t of e)g(t.contentRect.width)});return t.observe(e),()=>t.disconnect()},[]);let b=(0,i.useMemo)(()=>x<400?{fontSize:8,maxWidth:100}:x<600?{fontSize:10,maxWidth:140}:x<800?{fontSize:12,maxWidth:180}:{fontSize:14,maxWidth:228},[x]),p=(0,i.useMemo)(()=>{if(!m)return;let{attributeFilters:e,numericRanges:l,enabledRanges:r,includeEmptyValues:n,textSearch:i}=m;if(0!==Object.keys(e).length||0!==Object.keys(r).filter(e=>r[e]).length||""!==i.trim())return t.arguments.filter(t=>{if(""!==i.trim()){let e=i.trim().toLowerCase();if(!t.argument.toLowerCase().includes(e))return!1}if(t.attributes){for(let[l,r]of Object.entries(e)){var a;if(0===r.length)continue;let e=String(null!==(a=t.attributes[l])&&void 0!==a?a:"");if(!r.includes(e))return!1}for(let[e,i]of Object.entries(l)){if(!r[e])continue;let l=t.attributes[e];if(null==l||""===l){if(!n[e])return!1}else{let e=Number(l);if(Number.isNaN(e)||e<i[0]||e>i[1])return!1}}}else if(""===i.trim())return!1;return!0}).map(e=>e.arg_id)},[t.arguments,m]);return n?(0,r.jsx)(L.Dz,{size:"full",open:n,onOpenChange:a,children:(0,r.jsxs)(R.Z,{children:[(0,r.jsx)(L.Xi,{}),(0,r.jsx)(L.f5,{children:(0,r.jsx)(L.Cf,{children:(0,r.jsxs)(s.Box,{w:"100%",h:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",bg:"#171717",children:[(0,r.jsx)(v.HStack,{id:"fullScreenButtons",position:"fixed",top:5,right:5,zIndex:1,children:(0,r.jsx)(A,{content:"全画面終了",openDelay:0,closeDelay:0,children:(0,r.jsx)(f.Button,{onClick:a,h:"50px",borderWidth:2,children:(0,r.jsx)(M.I,{children:(0,r.jsx)(D.A,{})})})})}),("scatterAll"===l||"scatterDensity"===l)&&(0,r.jsx)(S,{clusterList:t.clusters,argumentList:t.arguments,targetLevel:"scatterAll"===l?1:Math.max(...t.clusters.map(e=>e.level)),onHover:()=>setTimeout(T,500),showClusterLabels:o,filteredArgumentIds:p,config:t.config}),"treemap"===l&&(0,r.jsx)(w,{clusterList:t.clusters,argumentList:t.arguments,onHover:T,level:u,onTreeZoom:d,filteredArgumentIds:p},u)]})})})]})}):(0,r.jsx)(s.Box,{ref:h,w:"100%",overflow:"hidden",borderRadius:"lg",border:"1px solid",borderColor:"gray.700",bg:"#171717",children:(0,r.jsxs)(s.Box,{h:{base:"300px",sm:"400px",md:"500px"},bg:"#171717",children:["treemap"===l&&(0,r.jsx)(w,{clusterList:t.clusters,argumentList:t.arguments,level:u,onTreeZoom:d,filteredArgumentIds:p},u),("scatterAll"===l||"scatterDensity"===l)&&(0,r.jsx)(S,{clusterList:t.clusters,argumentList:t.arguments,targetLevel:"scatterAll"===l?1:Math.max(...t.clusters.map(e=>e.level)),showClusterLabels:o,filteredArgumentIds:p,config:t.config,labelFontSize:b.fontSize,labelMaxWidth:b.maxWidth})]})})}function T(){let e=document.querySelector(".hoverlayer"),t=document.getElementById("fullScreenButtons");if(!e||!t)return;let l=e.getBoundingClientRect(),r=t.getBoundingClientRect();if(r.top>l.bottom||r.bottom<l.top||r.left>l.right||r.right<l.left)return;let n=r.bottom-l.top,i=e.querySelector(".hovertext");if(!i)return;let a=i.getAttribute("transform");if(!a)return;let o="".concat(a.split(",")[0],",").concat((Number(a.split(",")[1].slice(0,-1))+n).toString(),")");i.setAttribute("transform",o);let s=i.querySelector("path");if(!s)return;let c=s.getAttribute("d");if(!c)return;let u=c.match(/[Ll]/g);if(!u)return;let d=u[0],m="".concat(c.split(",")[0],",").concat((Number(c.split(",")[1].split(d)[0])-n).toString()).concat(d).concat(c.split(d)[1]);s.setAttribute("d",m)}function E(e){let{title:t,body:l,titleBgColor:n="#000000",className:i}=e;return(0,r.jsxs)(s.Box,{display:"flex",flexDirection:"column",width:"100%",overflow:"hidden",borderRadius:"lg",border:"1px solid",borderColor:"gray.700",className:i,children:[(0,r.jsx)(m.Flex,{alignItems:"center",justifyContent:"space-between",px:4,py:3,bg:n,children:(0,r.jsx)(s.Box,{fontWeight:"bold",children:t})}),(0,r.jsx)(m.Flex,{flex:1,alignItems:"center",bg:"gray.800",p:5,children:l})]})}var I=l(94063);function W(e){let{cluster:t}=e,l=(0,r.jsxs)(m.Flex,{alignItems:"center",gap:2,color:"white",children:[(0,r.jsx)(I.A,{size:18,color:"#38bdf8"}),(0,r.jsxs)(c.Text,{as:"span",color:"#38bdf8",fontWeight:"bold",children:[t.value.toLocaleString(),"件"]}),(0,r.jsx)(c.Text,{as:"span",ml:2,children:t.label})]}),n=(0,r.jsx)(c.Text,{color:"gray.300",fontSize:"sm",lineHeight:"tall",children:t.takeaway});return(0,r.jsx)(s.Box,{id:t.label,w:"100%",children:(0,r.jsx)(E,{title:l,body:n,titleBgColor:"#000000"})})}var H=l(43235),F=l(92860);let P=i.forwardRef(function(e,t){var l;let{marks:n,label:i,showValue:a,...o}=e,s=null!==(l=e.defaultValue)&&void 0!==l?l:e.value,c=null==n?void 0:n.map(e=>"number"==typeof e?{value:e,label:void 0}:e),u=!!(null==c?void 0:c.some(e=>e.label));return(0,r.jsxs)(H.g1,{ref:t,thumbAlignment:"center",...o,children:[i&&!a&&(0,r.jsx)(H.KV,{children:i}),i&&a&&(0,r.jsxs)(v.HStack,{justify:"space-between",children:[(0,r.jsx)(H.KV,{children:i}),(0,r.jsx)(H.Ie,{})]}),(0,r.jsxs)(H.XB,{"data-has-mark-label":u||void 0,children:[(0,r.jsx)(H.hB,{children:(0,r.jsx)(H.tO,{})}),(0,r.jsx)(V,{value:s}),(0,r.jsx)(q,{marks:c})]})]})});function V(e){let{value:t}=e;return(0,r.jsx)(F.a,{each:t,children:(e,t)=>(0,r.jsx)(H.OQ,{index:t,children:(0,r.jsx)(H.Un,{})},t)})}let q=i.forwardRef(function(e,t){let{marks:l}=e;return(null==l?void 0:l.length)?(0,r.jsx)(H.lq,{ref:t,children:l.map((e,t)=>{let l="number"==typeof e?e:e.value,n="number"==typeof e?void 0:e.label;return(0,r.jsxs)(H.mH,{value:l,children:[(0,r.jsx)(H.nI,{}),n]},l)})}):null});var X=l(29513);let Z=i.forwardRef(function(e,t){let{children:l,inputProps:n,rootRef:i,...a}=e;return(0,r.jsxs)(X.lq,{ref:i,...a,children:[(0,r.jsx)(X.tD,{ref:t,...n}),(0,r.jsx)(X.oO,{children:(0,r.jsx)(X.pD,{})}),null!=l&&(0,r.jsx)(X.$X,{children:l})]})});var K=l(58126);function $(e){let{onClose:t,onChangeFilter:l,currentMaxDensity:n,currentMinValue:a,showClusterLabels:u=!1,onToggleClusterLabels:d}=e,[m,h]=(0,i.useState)(n),[x,g]=(0,i.useState)(a);return(0,r.jsx)(o.Dz,{lazyMount:!0,open:!0,onOpenChange:t,children:(0,r.jsxs)(o.Cf,{children:[(0,r.jsxs)(o.R4,{children:[(0,r.jsxs)(s.Box,{mb:6,mt:4,children:[(0,r.jsx)(c.Text,{fontWeight:"bold",mb:2,fontSize:"md",children:"表示設定"}),(0,r.jsx)(c.Text,{fontSize:"sm",mb:5,children:"「全体図」および「濃い意見グループ」に関する設定項目です。"}),(0,r.jsx)(s.Box,{p:2,borderRadius:"md",borderWidth:"1px",borderColor:"gray.200",mb:2,children:(0,r.jsxs)(v.HStack,{gap:2,alignItems:"center",children:[(0,r.jsx)(c.Text,{fontSize:"sm",children:"意見グループ名を表示"}),(0,r.jsx)(K.h,{}),(0,r.jsx)(Z,{checked:u,onChange:()=>null==d?void 0:d(!u),size:"sm"})]})})]}),(0,r.jsx)(s.Box,{borderBottom:"1px solid",borderColor:"gray.200",mb:6}),(0,r.jsxs)(s.Box,{mb:4,children:[(0,r.jsx)(c.Text,{fontWeight:"bold",mb:2,fontSize:"md",children:"濃い意見グループ設定"}),(0,r.jsx)(c.Text,{fontSize:"sm",mb:5,children:"「濃い意見グループ」に関する設定項目です。"}),(0,r.jsx)(P,{label:"上位何％の意見グループを表示するか: ".concat(100*m,"%"),step:.1,min:.1,max:1,value:[m],onValueChange:e=>h(Number(e.value[0])),marks:[{value:.1,label:"10%"},{value:1,label:"100%"}]})]}),(0,r.jsx)(s.Box,{children:(0,r.jsx)(P,{label:"意見グループのサンプル数の最小数: ".concat(x),step:1,min:0,max:10,value:[x],onValueChange:e=>g(Number(e.value[0])),marks:[{value:0,label:"0"},{value:10,label:"10"}]})})]}),(0,r.jsxs)(o.Es,{justifyContent:"space-between",children:[(0,r.jsx)(K.h,{}),(0,r.jsx)(s.Box,{children:(0,r.jsx)(f.Button,{onClick:function(){l(m,x),t()},children:"設定を適用"})})]}),(0,r.jsx)(o.tK,{})]})})}var Y=l(35599);function U(e){let{result:t}=e,[l,n]=(0,i.useState)(t),[a,o]=(0,i.useState)(!1),[c,u]=(0,i.useState)("scatterAll"),[d,m]=(0,i.useState)(.2),[h,f]=(0,i.useState)(5),[x,g]=(0,i.useState)(!1),[p,v]=(0,i.useState)(!0),[j,y]=(0,i.useState)(!0),[C,S]=(0,i.useState)("0"),w=(0,i.useMemo)(()=>t.arguments.map(e=>{if(e.attributes){let t={};for(let[l,r]of Object.entries(e.attributes))t[l]=null==r?"":String(r);return t}return{}}),[t]),[k,z]=(0,i.useState)([]);(0,i.useEffect)(()=>{if(!w||0===w.length){z([]);return}let e={};for(let l of w)for(let[r,n]of Object.entries(l)){var t;let l="string"==typeof n?n:String(null!=n?n:"");if(e[r]||(e[r]={valueSet:new Set,valueCounts:new Map,isNumeric:!0}),e[r].valueSet.add(l),e[r].valueCounts.set(l,(null!==(t=e[r].valueCounts.get(l))&&void 0!==t?t:0)+1),""!==l.trim()){let t=Number(l);Number.isNaN(t)?e[r].isNumeric=!1:e[r].isNumeric&&((void 0===e[r].min||t<e[r].min)&&(e[r].min=t),(void 0===e[r].max||t>e[r].max)&&(e[r].max=t))}}z(Object.entries(e).map(e=>{var t;let l;let[r,n]=e,i=Array.from(n.valueSet).filter(e=>""!==e).sort(),a={};for(let e of i)a[e]=null!==(t=n.valueCounts.get(e))&&void 0!==t?t:0;return n.isNumeric&&i.length>0&&void 0!==n.min&&void 0!==n.max&&(l=[n.min,n.max]),{name:r,type:n.isNumeric?"numeric":"categorical",values:i,valueCounts:a,numericRange:l}}))},[w]);let[N,_]=(0,i.useState)({}),[B,R]=(0,i.useState)({}),[A,L]=(0,i.useState)({}),[M,D]=(0,i.useState)({}),[T,E]=(0,i.useState)(""),[I,H]=(0,i.useState)(!1);function F(e,l){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T;if(!t)return;let a=t.arguments,o=[],s=Object.keys(r).length>0||Object.keys(A).filter(e=>A[e]).length>0||""!==i.trim();s&&(o=(a=t.arguments.filter(e=>{if(""!==i.trim()){let t=i.trim().toLowerCase();if(!e.argument.toLowerCase().includes(t))return!1}if(e.attributes){let t=Object.entries(r).every(t=>{var l;let[r,n]=t,i=null===(l=e.attributes)||void 0===l?void 0:l[r];if(1===n.length&&n[0].startsWith("range:")){let[e,t,l]=n[0].split(":"),r=Number(t),a=Number(l),o=Number(i);return!Number.isNaN(o)&&o>=r&&o<=a}return n.includes(String(i))}),l=Object.entries(B).every(t=>{var l;let[r,n]=t;if(!A[r])return!0;let i=null===(l=e.attributes)||void 0===l?void 0:l[r];if(null==i||""===i)return M[r]||!1;let a=Number(i);return!Number.isNaN(a)&&a>=n[0]&&a<=n[1]});return t&&l}return""===i.trim()})).map(e=>e.arg_id));let c=new Set;for(let e of a)for(let t of e.cluster_ids)c.add(t);let{filtered:u}=G(t.clusters||[],e,l),d=u.map(e=>s&&!c.has(e.id)?{...e,allFiltered:!0}:e);n({...t,clusters:d,arguments:t.arguments,filteredArgumentIds:s?o:void 0})}(0,i.useEffect)(()=>{let{filtered:e,isEmpty:l}=G(t.clusters||[],d,h);v(!l)},[d,h,t.clusters]),(0,i.useMemo)(()=>0===Object.keys(N).length&&0===Object.keys(A).filter(e=>A[e]).length?w:w.filter(e=>{var t,l,r;for(let[l,r]of Object.entries(N))if(r.length>0&&void 0!==r[0]&&!r.includes(null!==(t=e[l])&&void 0!==t?t:""))return!1;for(let[t,n]of Object.entries(B))if(A[t]){let i=null!==(r=null===(l=e[t])||void 0===l?void 0:l.trim())&&void 0!==r?r:"";if(""===i){if(!M[t])return!1}else{let e=Number(i);if(Number.isNaN(e)||e<n[0]||e>n[1])return!1}}return!0}),[w,N,B,A,M]);let P=(0,i.useMemo)(()=>{let e=[];if("scatterDensity"===c){let t=Math.max(...l.clusters.map(e=>e.level));e=l.clusters.filter(e=>e.level===t)}else e=t.clusters.filter(e=>1===e.level);return e.sort((e,t)=>t.value-e.value)},[t.clusters,l.clusters,c]),V=e=>y(e);return(0,r.jsxs)(s.Box,{minH:"100vh",bg:"black",children:[a&&(0,r.jsx)($,{currentMaxDensity:d,currentMinValue:h,onClose:()=>o(!1),onChangeFilter:function(e,t){m(e),f(t),("scatterDensity"===c||"scatterAll"===c)&&F(e,t)},showClusterLabels:j,onToggleClusterLabels:V}),I&&(0,r.jsx)(b,{onClose:()=>H(!1),onApplyFilters:function(e,t,l,r,n){_(e),R(t),D(l),L(r),E(n),("scatterAll"===c||"scatterDensity"===c)&&F("scatterDensity"===c?d:1,"scatterDensity"===c?h:0,e,n)},attributes:k,initialFilters:N,initialNumericRanges:B,initialEnabledRanges:A,initialIncludeEmptyValues:M,initialTextSearch:T}),(0,r.jsx)(s.Box,{mb:6,children:(0,r.jsx)(O,{result:l,selectedChart:c,isFullscreen:x,onExitFullscreen:()=>g(!1),showClusterLabels:j,onToggleClusterLabels:V,treemapLevel:C,onTreeZoom:e=>S(e),filterState:{attributeFilters:N,numericRanges:B,enabledRanges:A,includeEmptyValues:M,textSearch:T}})}),(0,r.jsx)(Y.VStack,{gap:6,w:"100%",children:P.map(e=>(0,r.jsx)(W,{cluster:e},e.id))})]})}function G(e,t,l){let r=e.reduce((e,t)=>Math.max(e,t.level),0),n=e.filter(e=>e.level===r).filter(e=>e.density_rank_percentile<=t).filter(e=>e.value>=l);return{filtered:[...e.filter(e=>e.level!==r),...n],isEmpty:0===n.length}}},58768:(e,t,l)=>{Promise.resolve().then(l.bind(l,30934))},99840:(e,t,l)=>{"use strict";l.d(t,{Cf:()=>s,Dz:()=>u,Es:()=>d,L3:()=>f,R4:()=>h,Tt:()=>g,c7:()=>m,tK:()=>c,zM:()=>x});var r=l(95155),n=l(70318),i=l(89682),a=l(12115),o=l(18133);let s=a.forwardRef(function(e,t){let{children:l,portalled:a=!0,portalRef:o,backdrop:s=!0,...c}=e;return(0,r.jsxs)(n.Z,{disabled:!a,container:o,children:[s&&(0,r.jsx)(i.Xi,{}),(0,r.jsx)(i.f5,{children:(0,r.jsx)(i.Cf,{ref:t,...c,asChild:!1,children:l})})]})}),c=a.forwardRef(function(e,t){return(0,r.jsx)(i.tK,{position:"absolute",top:"2",insetEnd:"2",...e,asChild:!0,children:(0,r.jsx)(o.J,{size:"sm",ref:t,children:e.children})})}),u=i.Dz,d=i.Es,m=i.c7,h=i.R4;i.Xi;let f=i.L3;i.rr;let x=i.zM,g=i.Tt}},e=>{var t=t=>e(e.s=t);e.O(0,[150,315,567,458,257,980,398,441,684,358],()=>t(58768)),_N_E=e.O()}]);